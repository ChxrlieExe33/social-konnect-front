<article class="w-[85vw] lg:w-[40vw] bg-white rounded-2xl flex flex-col items-center justify-between pt-5 shadow-2xl">

    <span class="flex items-center justify-between px-5 mb-3 w-full">

        <a class="flex items-center justify-items-start cursor-pointer" [routerLink]="'/profile/user/' + postData().username">

            @if (postData().profilePictureUrl) {
                <img class="h-10 w-10 rounded-full" [src]="postData().profilePictureUrl" alt="Profile picture"/>
            } @else {
                <img class="h-10 w-10 rounded-full" src="/anonymous-pfp.webp" alt="Profile picture"/>
            }

            <p class="text-xl font-bold py-2 px-3 hover:scale-110"> {{postData().username}} </p>

        </a>

        @if (!menuOpen()) {
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 hover:scale-110 cursor-pointer" (click)="toggleMenu()">
                <g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M14 12C14 13.1046 13.1046 14 12 14C10.8954 14 10 13.1046 10 12C10 10.8954 10.8954 10 12 10C13.1046 10 14 10.8954 14 12Z" stroke="#000000" stroke-width="0.9600000000000002" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M14 19C14 20.1046 13.1046 21 12 21C10.8954 21 10 20.1046 10 19C10 17.8954 10.8954 17 12 17C13.1046 17 14 17.8954 14 19Z" stroke="#000000" stroke-width="0.9600000000000002" stroke-linecap="round" stroke-linejoin="round"></path> <path d="M14 5C14 6.10457 13.1046 7 12 7C10.8954 7 10 6.10457 10 5C10 3.89543 10.8954 3 12 3C13.1046 3 14 3.89543 14 5Z" stroke="#000000" stroke-width="0.9600000000000002" stroke-linecap="round" stroke-linejoin="round"></path> </g>
            </svg>
        }

        @if (menuOpen()) {
            <app-post-options-modal (closeModal)="toggleMenu()" [postOwnedByCurrentUser]="postOwnedByCurrentUser()" [postId]="postData().postId" (deletePost)="deletePost$.next()"/>
        }

    </span>

    @if (postMedia() && postMedia().length > 0) {
        <div class="relative w-[97%] border-y-1 rounded-xl overflow-hidden">
            <!-- Media Container -->
            <div class="overflow-hidden">
                <div
                    class="flex transition-transform duration-300 ease-in-out"
                    [style.transform]="'translateX(-' + (currentMediaIndex * 100) + '%)'"
                >
                    @for (media of postMedia(); track media.media_url) {
                        <div class="w-full flex-shrink-0">
                            @if (media.media_type === 'IMAGE') {
                                <img
                                    [src]="media.media_url"
                                    alt="Post media"
                                    class="w-full cursor-pointer h-full rounded-xl"
                                    (click)="navigateToPostDetail()"
                                />
                            } @else {
                                <video
                                    [src]="media.media_url"
                                    class="w-full cursor-pointer h-full rounded-xl"
                                    (click)="navigateToPostDetail()"
                                    controls
                                ></video>
                            }
                        </div>
                    }
                </div>
            </div>

            <!-- Navigation Arrows (only show if more than 1 media item) -->
            @if (postMedia().length > 1) {
                <!-- Previous Button -->
                <button
                    class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-opacity"
                    (click)="previousMedia()"
                    [disabled]="currentMediaIndex === 0"
                    [class.opacity-50]="currentMediaIndex === 0"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                    </svg>
                </button>

                <!-- Next Button -->
                <button
                    class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 text-white rounded-full p-2 hover:bg-opacity-70 transition-opacity"
                    (click)="nextMedia()"
                    [disabled]="currentMediaIndex === postMedia().length - 1"
                    [class.opacity-50]="currentMediaIndex === postMedia().length - 1"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                    </svg>
                </button>

                <!-- Media Indicators -->
                <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-2">
                    @for (media of postMedia(); track $index) {
                        <button
                            class="w-2 h-2 rounded-full transition-colors"
                            [class]="currentMediaIndex === $index ? 'bg-white' : 'bg-white bg-opacity-50'"
                            (click)="goToMedia($index)"
                        ></button>
                    }
                </div>
            }
        </div>
    }

    <!-- If there is no media, display caption where media goes -->
    @if (!postMedia() || !(postMedia().length > 0)){
        <p class="self-start p-5"><b>{{ postData().username}}</b> {{ postData().caption }}</p>

    }

    <span class="w-full flex items-center justify-items-start px-3 pt-3">
        <!-- Display heart in pink if liked, white if not -->
        @if (liked()) {
            <svg xmlns="http://www.w3.org/2000/svg" fill="crimson" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="size-6 w-12 h-12 cursor-pointer hover:scale-110" (click)="changeLikeStatus()">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
            </svg>
        } @else {
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="size-6 w-12 h-12 cursor-pointer hover:scale-110" (click)="changeLikeStatus()">
                <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" />
            </svg>
        }

        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" fill="#000000" class="size-6 w-9 h-9 cursor-pointer hover:scale-110" (click)="navigateToPostDetail()">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <title>comment-1</title> <desc>Created with Sketch Beta.</desc> <defs> </defs> <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> <g id="Icon-Set"  transform="translate(-100.000000, -255.000000)" fill="#000000"> <path d="M116,281 C114.832,281 113.704,280.864 112.62,280.633 L107.912,283.463 L107.975,278.824 C104.366,276.654 102,273.066 102,269 C102,262.373 108.268,257 116,257 C123.732,257 130,262.373 130,269 C130,275.628 123.732,281 116,281 L116,281 Z M116,255 C107.164,255 100,261.269 100,269 C100,273.419 102.345,277.354 106,279.919 L106,287 L113.009,282.747 C113.979,282.907 114.977,283 116,283 C124.836,283 132,276.732 132,269 C132,261.269 124.836,255 116,255 L116,255 Z" id="comment-1" > </path> </g> </g> </g>
        </svg>

    </span>

    <p class="self-start py-3 pl-5">{{ postData().createdAt | timeAgo }}</p>

    <!-- If there is media, display caption down here -->
    @if (postMedia() && postMedia().length > 0){

        <p class="self-start p-5"><b>{{ postData().username}}</b> {{ postData().caption }}</p>

    }

</article>
